{% extends "index.html" %}

{% macro render_subsections(subsections) %}
  {% if subsections %}
    <ul class="subsection-list">
      {% for s in subsections %}
        {% set subsection = get_section(path=s) %}
        <li>
          <a href="{{ subsection.permalink | safe }}">
            {{ subsection.title }}
          </a>

          {# 🔁 재귀적으로 하위 섹션 렌더링 #}
          {{ self::render_subsections(subsections=subsection.subsections) }}
          
          {# 하위 페이지 렌더링 #}
          {% if subsection.pages %}
            <ul class="page-list">
              {% for page in subsection.pages %}
                <li>
                  <a href="{{ page.permalink | safe }}">{{ page.title }}</a>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}


{% block content %}
  <h1>{{ section.title }}</h1>

  {% if section.content %}
    <div class="section-content">
      {{ section.content | safe }}
    </div>
  {% endif %}

  {# 🔁 재귀 렌더링 시작점 #}
  {{ self::render_subsections(subsections=section.subsections) }}

  {# 현재 섹션의 페이지 목록 #}
  {% if section.pages %}
    <ul class="page-list">
      {% for page in section.pages %}
        <li>
          <a href="{{ page.permalink | safe }}">{{ page.title }}</a>
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endblock content %}


{% block prev_link %}
  {% set index = get_section(path="_index.md") %}
  {% set found_current = false %}
  {% for s in index.subsections %}
    {% set subsection = get_section(path=s) %}
    {% if found_current %}
      <a class="previous" href="{{ subsection.permalink | safe }}"><</a>
      {% set_global found_current = false %}
    {% endif %}
    {% if subsection.permalink == section.permalink %}
      {% set_global found_current = true %}
    {% endif %}
  {% endfor %}
{% endblock prev_link %}


{% block next_link %}
  {% set index = get_section(path="_index.md") %}
  {% set found_current = false %}
  {% for s in index.subsections %}
    {% set subsection = get_section(path=s) %}
    {% if found_current %}
      <a class="next" href="{{ subsection.permalink | safe }}">></a>
      {% set_global found_current = false %}
    {% endif %}
    {% if subsection.permalink == section.permalink %}
      {% set_global found_current = true %}
    {% endif %}
  {% endfor %}
{% endblock next_link %}
